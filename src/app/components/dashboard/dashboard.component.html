<p-tabs [(value)]="activeTabIndex">
  <p-tablist>
    <p-tab *ngFor="let ds of datastorelist; let i = index" [value]="i">
      {{ ds.name }}
    </p-tab>
  </p-tablist>

  <p-tabpanels>
    <p-tabpanel *ngFor="let ds of datastorelist; let i = index" [value]="i">
      <div class="grid mx-0">
        <!-- Table Select -->
        <div class="col-6">
          <div class="field">
            <label for="tableSelect{{ i }}">Select Table</label>
            <p-select inputId="tableSelect{{ i }}" [options]="ds.tables" [(ngModel)]="selectedTables[ds.name]"
              optionLabel="name" placeholder="Choose a Table"
              (onChange)="handleTableSelect(ds.name); onTableChange(ds.name, selectedTables[ds.name])">
            </p-select>
          </div>
        </div>

        <!-- Chart Type Select -->
        <div class="col-6">
          <div class="field">
            <label>Chart Type</label>
            <p-select *ngIf="selectedTables[ds.name]" [options]="chartTypes" [(ngModel)]="selectedChartTypes[ds.name]"
              (ngModelChange)="onChartTypeChange(ds.name)" optionLabel="label" optionValue="value"
              placeholder="Select Chart Type">
            </p-select>
          </div>
        </div>

        <!-- X-Axis Select -->
        <div class="col-6">
          <div class="field">
            <label>X-Axis Column</label>
            <p-select *ngIf="selectedColumns[ds.name]" [options]="xAxisOptions[ds.name]"
              [(ngModel)]="selectedColumns[ds.name].x" [disabled]="!selectedChartTypes[ds.name]"
              placeholder="Select X Column">
            </p-select>
          </div>
        </div>

        <!-- Y-Axis Select -->
        <div class="col-6">
          <div class="field">
            <label>Y-Axis Column</label>
            <p-select *ngIf="selectedColumns[ds.name]" [options]="yAxisOptions[ds.name]"
              [(ngModel)]="selectedColumns[ds.name].y" [disabled]="!selectedChartTypes[ds.name]"
              placeholder="Select Y Column">
            </p-select>
          </div>
        </div>

        <!-- Analysis Type Select -->
        <!-- <div class="col-6">
          <div class="field">
            <label>Analysis Type</label>
            <p-select [options]="analysisTypes" [(ngModel)]="selectedAnalysisType" placeholder="Select Analysis Type">
            </p-select>

          </div>
        </div> -->


        <!-- Fetch Chart Data Button -->
        <div class="col-12 mt-2">
          <button pButton type="button" label="Fetch Chart Data" icon="pi pi-chart-bar"
            (click)="generateChartData(ds.name)">Fetch Data
          </button>
        </div>

        <!-- Always show canvas with fixed size -->
        <canvas id="chartCanvas-{{ ds.name }}" style="width: 100%; height: 400px;"></canvas>
      </div>
    </p-tabpanel>
  </p-tabpanels>
</p-tabs>